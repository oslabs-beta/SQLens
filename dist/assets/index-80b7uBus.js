import{c as e,R as a,j as t,I as n,d as l,D as s,a as r,b as o,e as i,B as c,r as d,H as m,P as u,T as h,f as p,C as b,g,h as x,u as f,A as j,i as y,k as N,M as w,l as T,m as C,n as v,F as S,S as $,O as k,o as E,p as O,q as D,s as z,t as A,v as q,w as P,x as U,y as I,z as _,E as F,G as L,J as R,K as W,L as J,N as K,Q as M,U as Y,V as B,W as G,X,Y as V}from"./vendors-sW7PeAS8.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&a(e)})).observe(document,{childList:!0,subtree:!0})}function a(e){if(e.ep)return;e.ep=!0;const a=function(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?a.credentials="include":"anonymous"===e.crossOrigin?a.credentials="omit":a.credentials="same-origin",a}(e);fetch(e.href,a)}}();const Z=e(((e,a)=>({tables:[],setTables:a=>e({tables:a}),searchValue:"",setSearchValue:a=>e({searchValue:a}),fetchTables:async()=>{try{const a=await async function(){const e=await fetch("/api/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n          query {\n            getTableNames {\n              name\n              columns\n              foreignKeys {\n                columnName\n                foreignTableName\n                foreignColumnName\n              }\n            }\n          }\n        "})}),a=await e.json();if(a.errors)throw console.error(a.errors),new Error("Error fetching tables");return a.data.getTableNames}();e({tables:a})}catch(a){console.error("Error fetching tables:",a)}},fetchAndUpdateTableDetails:async(t,n)=>{try{const l=await async function(e){const a=await fetch("/api/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n          query GetTableDetails($tableName: String!) {\n            getTableDetails(tableName: $tableName) {\n              name\n              columns\n              foreignKeys {\n                columnName\n                foreignTableName\n                foreignColumnName\n              }\n            }\n          }\n        ",variables:{tableName:e}})}),t=await a.json();if(t.errors)throw console.error(t.errors),new Error("Error fetching table details");return t.data.getTableDetails}(t),s=a().tables;let r;r=n?s.map((e=>e.name===n?l:e)):s.map((e=>e.name===t?l:e)),e({tables:r})}catch(l){console.error("Error fetching updated table details:",l)}}}))),H=({data:e})=>{const[d,m]=a.useState(!1),u=Z((e=>e.fetchAndUpdateTableDetails));return t.jsxs(t.Fragment,{children:[t.jsx(n,{"aria-label":"delete",size:"small",onClick:()=>{m(!0)},children:t.jsx(l,{fontSize:"inherit"})}),t.jsxs(s,{open:d,onClose:()=>m(!1),"aria-describedby":"alert-dialog-description",children:[t.jsx(r,{children:t.jsx(o,{id:"alert-dialog-description",children:"Are you sure you want to delete this column?"})}),t.jsxs(i,{children:[t.jsx(c,{onClick:()=>{m(!1)},children:"No"}),t.jsx(c,{onClick:async()=>await async function(){const a=await fetch("/api/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n          mutation deleteColumn($tableName: String!, $columnName: String!){\n            deleteColumn(tableName: $tableName, columnName: $columnName)\n          }\n        ",variables:{columnName:e.label,tableName:e.parent}})}),t=await a.json();t.errors?(console.error(t.errors[0].message),alert(t.errors[0].message)):(await u(e.parent),m(!1))}(),autoFocus:!0,children:"Yes"})]})]})]})};H.displayName="DeleteColumnButton";const Q=({data:e})=>{const[a,l]=d.useState(!1),[s,r]=d.useState(e.label),o=Z((e=>e.fetchAndUpdateTableDetails));return t.jsxs("div",{className:"column-name-node",children:[t.jsx(m,{type:"target",position:u.Left}),t.jsx(m,{type:"source",position:u.Right}),a?t.jsx("input",{type:"text",value:s,onChange:e=>{r(e.currentTarget.value)},placeholder:e.label,className:"table-name-input"}):t.jsx(h,{className:"column-label",variant:"body2",noWrap:!0,children:s}),a?t.jsxs(p,{sx:{minWidth:56},children:[t.jsx(n,{"aria-label":"edit",size:"small",onClick:async()=>{l(!1),r(s.trim().replace(/[^A-Za-z0-9_]/g,"_"));const a=await fetch("/api/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n          mutation editColumn($newColumnName: String!, $columnName: String!, $tableName: String!){\n            editColumn( newColumnName: $newColumnName, columnName: $columnName, tableName: $tableName)\n          }\n        ",variables:{newColumnName:s,columnName:e.label,tableName:e.parent}})}),t=await a.json();t.errors?(console.error(t.errors[0].message),alert(t.errors[0].message)):await o(e.parent)},children:t.jsx(b,{fontSize:"inherit"})}),t.jsx(n,{"aria-label":"cancel",size:"small",onClick:()=>{r(e.label),l(!1)},children:t.jsx(g,{fontSize:"inherit"})})]}):t.jsxs(p,{sx:{minWidth:56},children:[t.jsx(n,{"aria-label":"edit",size:"small",onClick:()=>{l(!0)},children:t.jsx(x,{fontSize:"inherit"})}),t.jsx(H,{data:e})]})]})};Q.displayName="ColumnNameNode";function ee(){const e=f(),[a,l]=d.useState(null),s=Boolean(a),r=()=>{l(null)},o=t.jsxs(w,{anchorEl:a,anchorOrigin:{vertical:"bottom",horizontal:"left"},id:"primary-search-account-menu",keepMounted:!0,open:s,onClose:r,children:[t.jsx(T,{onClick:async()=>{if(window.confirm("Do you want to download the file?"))try{const e="./migration_log.txt",a=await fetch(e),t=await a.blob(),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download="migration_log.txt",n.click(),URL.revokeObjectURL(n.href)}catch(e){console.error("Error downloading file:",e)}else r()},children:"Download Migration File"}),t.jsx(T,{onClick:()=>{l(null),e("/")},children:"Logout"})]});return t.jsxs(p,{sx:{flexGrow:1},children:[t.jsx(j,{position:"static",style:{background:"rgba(0, 0, 0, .25)",boxShadow:"none"},children:t.jsxs(y,{children:[t.jsx(n,{size:"large",edge:"start",color:"inherit","aria-label":"open drawer",sx:{mr:2},onClick:e=>{l(e.currentTarget)},children:t.jsx(N,{})}),t.jsx("div",{className:"nav-title",children:t.jsxs("div",{id:"nav-text",className:"nav-title-text",children:["SQL",t.jsx("span",{children:"ens"})]})})]})}),o]})}function ae({handleAddColumnOpen:e,handleAlertOpen:a,handleEditTableName:l,anchorEl:s,handleClick:r,handleClose:o}){const i=Boolean(s),c=i?"simple-popover":void 0;return t.jsxs("div",{className:"table-menu-dots",children:[t.jsx(n,{"aria-label":"expandTableMenu",style:{color:"white"},onClick:r,children:t.jsx(C,{})}),t.jsxs(v,{id:c,open:i,anchorEl:s,onClose:o,anchorOrigin:{vertical:"bottom",horizontal:"left"},sx:{".MuiPaper-root":{backgroundColor:"rgba(200, 200, 200, 0.9)"}},children:[t.jsx(T,{onClick:l,style:{color:"black"},children:"Edit Table Name"}),t.jsx(T,{onClick:e,style:{color:"black"},children:"Add Column"}),t.jsx(T,{onClick:a,style:{color:"black"},children:"Delete Table"})]})]})}const te={PaperProps:{style:{maxHeight:224,width:250}}},ne=["bit(8)","bool","box","bytea","char(10)","cidr","circle","date","decimal (8, 2)","float4","float8","inet","int, int4","int2","int8","interval (6)","json","jsonb","line","lseg","macaddr","macaddr8","money","path","pg_lsn","pg_snapshot","point","polygon","serial2","serial4","serial8","text","time (3) without time zone","timestamp (6) without time zone","timestamptz","timetz","tsquery","tsvector","txid_snapshot","uuid","varbit(16)","varchar (255)","xml"];function le({handleDataTypeChange:e,selectedDataType:a}){return t.jsx("div",{children:t.jsx(S,{sx:{m:1,width:300,mt:3},children:t.jsxs($,{displayEmpty:!0,value:a,onChange:e,input:t.jsx(k,{}),MenuProps:te,inputProps:{"aria-label":"Without label"},children:[t.jsx(T,{disabled:!0,value:"",children:t.jsx("em",{children:"Select Data Type"})}),ne.map((e=>t.jsx(T,{value:e,children:e},e)))]})})})}function se({tableName:e,handleAddColumnClose:n,openColDialog:l}){const[o,m]=d.useState(""),[u,h]=d.useState(""),p=Z((e=>e.fetchAndUpdateTableDetails));return t.jsx(a.Fragment,{children:t.jsxs(s,{open:l,onClose:n,children:[t.jsxs(r,{children:[t.jsx(E,{children:"Add Column and Data Type"}),t.jsx(O,{autoFocus:!0,required:!0,margin:"dense",id:"columnName",name:"columnName",label:"Column Name",type:"text",variant:"standard",onChange:e=>{m(e.currentTarget.value)},fullWidth:!0}),t.jsx(le,{handleDataTypeChange:e=>{h(e.target.value)},selectedDataType:u})]}),t.jsxs(i,{children:[t.jsx(c,{onClick:n,children:"Cancel"}),t.jsx(c,{onClick:async()=>{n(),m(o.trim().replace(/[^A-Za-z0-9_]/g,"_"));const a=await fetch("/api/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n          mutation addColumnToTable($tableName: String!, $columnName: String!, $dataType: String!){\n            addColumnToTable( tableName: $tableName, columnName: $columnName, dataType: $dataType)\n          }\n        ",variables:{tableName:e,columnName:o,dataType:u}})}),t=await a.json();t.errors?(console.error(t.errors[0].message),alert(t.errors[0].message)):p(e)},children:"Save"})]})]})})}const re=({data:e})=>{const[l,m]=a.useState(!1),[u,x]=d.useState(!1),[f,j]=d.useState(e.label),[y,N]=a.useState(null),w=Z((e=>e.fetchAndUpdateTableDetails)),T=Z((e=>e.tables)),C=Z((e=>e.setTables)),v=()=>{N(null)},[S,$]=a.useState(!1),k=()=>{v(),$(!0)};return t.jsxs(p,{className:"group-node",sx:{display:"flex",flexDirection:"column",alignItems:"stretch",justifyContent:"space-between",width:1},children:[u?t.jsxs(p,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx("input",{type:"text",value:f,onChange:e=>{j(e.currentTarget.value)},placeholder:e.label,className:"table-name-input",autoFocus:!0}),t.jsxs("div",{children:[t.jsx(n,{"aria-label":"edit",size:"small",onClick:async()=>{j(f.trim().replace(/[^A-Za-z0-9_]/g,"_"));const a=await fetch("/api/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n          mutation editTableName($oldName: String!, $newName: String!){\n            editTableName( oldName: $oldName, newName: $newName)\n          }\n        ",variables:{newName:f,oldName:e.label}})}),t=await a.json();t.errors?(j(e.label),console.error(t.errors[0].message),alert(t.errors[0].message)):(x(!1),await w(f,e.label))},children:t.jsx(b,{fontSize:"inherit"})}),t.jsx(n,{"aria-label":"cancel",size:"small",onClick:()=>{j(e.label),x(!1)},children:t.jsx(g,{fontSize:"inherit"})})]})]}):t.jsxs(p,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx(h,{variant:"h6",noWrap:!0,sx:{flexGrow:1,maxWidth:200},children:f}),t.jsx(ae,{handleEditTableName:()=>{v(),x(!0)},anchorEl:y,handleClose:v,handleClick:e=>{N(e.currentTarget)},handleAlertOpen:()=>{m(!0)},handleAddColumnOpen:k})]}),t.jsxs(s,{open:l,onClose:()=>m(!1),"aria-describedby":"alert-dialog-description",children:[t.jsx(r,{children:t.jsx(o,{id:"alert-dialog-description",children:"Are you sure you want to delete this table?"})}),t.jsxs(i,{children:[t.jsx(c,{onClick:()=>{m(!1)},children:"No"}),t.jsx(c,{onClick:async()=>{m(!1);const a=await fetch("/api/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n          mutation deleteTable($tableName: String!){\n            deleteTable( tableName: $tableName)\n          }\n        ",variables:{tableName:e.label}})}),t=await a.json();if(t.errors)throw console.error(t.errors[0].message),alert(t.errors[0].message),new Error("Error deleting table");{const a=T.filter((e=>e.name!==f));C(a),w(e.label)}},autoFocus:!0,children:"Yes"})]})]}),t.jsx(se,{tableName:f,handleAddColumnOpen:k,openColDialog:S,handleAddColumnClose:()=>{$(!1)}})]})},oe=({data:e})=>{const[a,l]=d.useState(!1),[s,r]=d.useState(""),o=Z((e=>e.fetchAndUpdateTableDetails)),i=Z((e=>e.tables)),c=Z((e=>e.setTables));return t.jsx(p,{className:"group-node",sx:{display:"flex",flexDirection:"column",alignItems:"stretch",justifyContent:"space-between",width:1},children:a?t.jsxs(p,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx("input",{type:"text",value:s,onChange:e=>{r(e.currentTarget.value)},placeholder:e.label,className:"table-name-input"}),t.jsxs(p,{children:[t.jsx(n,{"aria-label":"save",size:"small",onClick:async()=>{l(!1),r(s.trim().replace(/[^A-Za-z0-9_]/g,"_"));const a=await fetch("/api/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n          mutation addTable($tableName: String!){\n            addTable( tableName: $tableName)\n          }\n\n        ",variables:{tableName:s}})}),t=await a.json();if(t.errors)console.error(t.errors[0].message),alert(t.errors[0].message);else{c([...i,{name:s,columns:[],foreignKeys:[]}]),r(e.label),await o(e.label)}},children:t.jsx(b,{fontSize:"inherit"})}),t.jsx(n,{"aria-label":"cancel",size:"small",onClick:()=>{l(!1)},children:t.jsx(g,{fontSize:"inherit"})})]})]}):t.jsxs(p,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx(h,{className:"column-label",variant:"h6",noWrap:!0,children:e.label}),t.jsx(n,{"aria-label":"edit",size:"small",onClick:()=>{l(!0)},children:t.jsx(D,{fontSize:"inherit"})})]})})};function ie({data:e}){return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"cloud gradient",children:t.jsx("div",{children:t.jsx(z,{})})}),t.jsx("div",{className:"wrapper gradient",children:t.jsx("div",{className:"inner",children:"Add New Table"===e.label?t.jsx(oe,{data:e}):t.jsx(re,{data:e})})})]})}ie.displayName="TurboNode";const ce={turbo:ie,colNode:Q},de={turbo:function({id:e,sourceX:a,sourceY:n,targetX:l,targetY:s,sourcePosition:r,targetPosition:o,style:i={},markerEnd:c}){const d=a===l,m=n===s,[u]=A({sourceX:d?a+1e-4:a,sourceY:m?n+1e-4:n,sourcePosition:r,targetX:l,targetY:s,targetPosition:o});return t.jsx(t.Fragment,{children:t.jsx("path",{id:e,style:i,className:"react-flow__edge-path",d:u,markerEnd:c})})}},me={type:"turbo",markerEnd:"edge-circle"},ue=()=>{const[e,a,n]=q([]),[l,s,r]=P([]),o=Z((e=>e.tables)),i=d.useCallback((e=>s((a=>U(e,a)))),[s]);d.useEffect((()=>{if(o.length>0){const t=(e=>{const a=[];let t=0,n=0;e.forEach((e=>{n>600&&(n=0,t+=375);const l={id:`table-${e.name}`,type:"turbo",data:{label:e.name},className:"light",position:{x:t,y:n},style:{width:250,height:75+40*e.columns.length}};a.push(l);let s=60;e.columns.forEach((t=>{const n={id:`table-${e.name}-column-${t}`,data:{label:t,parent:e.name},type:"colNode",position:{x:15,y:s},parentNode:`table-${e.name}`,draggable:!1,extent:"parent",style:{width:220,height:40}};a.push(n),s+=40})),n+=150+40*e.columns.length}));const l={id:"add-table-node",type:"turbo",data:{label:"Add New Table"},position:{x:t,y:n},style:{width:250}};return a.push(l),a})(o),n=(e=>{const a=[];return e.forEach(((e,t)=>{e.foreignKeys.forEach(((n,l)=>{const s={id:`fk-${t}-${l}`,target:`table-${e.name}-column-${n.columnName}`,source:`table-${n.foreignTableName}-column-${n.foreignColumnName}`,animated:!1,style:{}};a.push(s)}))})),a})(o),l=t.map((a=>{const t=e.find((e=>e.id===a.id&&!a.id.includes("-column-")));return t?{...a,position:t.position}:a}));a(l),s(n)}}),[o,a,s]);return t.jsxs(t.Fragment,{children:[t.jsx(ee,{}),t.jsx("div",{className:"flow-container","data-testid":"flow-container",children:t.jsx(I,{nodes:e,edges:l,onNodesChange:n,onEdgesChange:r,onConnect:i,edgeTypes:de,defaultEdgeOptions:me,nodeTypes:ce,fitView:!0,deleteKeyCode:null,proOptions:{hideAttribution:!0},children:t.jsx("svg",{children:t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"edge-gradient",children:[t.jsx("stop",{offset:"0%",stopColor:"#ae53ba"}),t.jsx("stop",{offset:"100%",stopColor:"#2a8af6"})]}),t.jsx("marker",{id:"edge-circle",viewBox:"-5 -5 10 10",refX:"0",refY:"0",markerUnits:"strokeWidth",markerWidth:"10",markerHeight:"10",orient:"auto",children:t.jsx("circle",{stroke:"#2a8af6",strokeOpacity:"0.75",r:"2",cx:"0",cy:"0"})})]})})})})]})},he=()=>t.jsxs("div",{className:"ocean",children:[t.jsx("div",{className:"wave"}),t.jsx("div",{className:"wave wave2"})]}),pe=()=>{const e=d.useRef(null),a=f(),{fetchTables:l}=Z((e=>({fetchTables:e.fetchTables})));return d.useEffect((()=>{_.timeline({autoplay:!0,delay:200}).add({targets:e.current,translateY:[-100,0],opacity:[0,1],elasticity:600,duration:800}).add({targets:"#logo-hexagon",rotate:[-90,0],duration:600,elasticity:600,offset:50}).add({targets:"#logo-circle",scale:[0,1],duration:600,elasticity:600,offset:250}).add({targets:"#logo-text",translateX:["-100%",0],opacity:[0,1],duration:500,easing:"easeOutExpo",offset:500})}),[]),t.jsxs("div",{className:"outer-container","data-testid":"outer-container",children:[t.jsx("div",{className:"logo-container",children:t.jsxs("div",{className:"site-logo",children:[t.jsx("figure",{id:"logo",ref:e,children:t.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 148 128",children:[t.jsx("defs",{children:t.jsxs("mask",{id:"circle-mask",children:[t.jsx("rect",{fill:"white",width:"100%",height:"100%"}),t.jsx("circle",{id:"logo-mask",fill:"black",cx:"120",cy:"96",r:"28"})]})}),t.jsx("polygon",{id:"logo-hexagon",fill:"#646cff",points:"64 128 8.574 96 8.574 32 64 0 119.426 32 119.426 96",mask:"url(#circle-mask)"}),t.jsx("circle",{id:"logo-circle",fill:"#e92a67",cx:"120",cy:"96",r:"20"})]})}),t.jsx("div",{className:"site-title",children:t.jsxs("div",{id:"logo-text",className:"site-title-text",children:["SQL",t.jsx("span",{children:"ens"})]})})]})}),t.jsxs("div",{className:"input-container",children:[t.jsxs("form",{style:{display:"flex",alignItems:"center"},onSubmit:async e=>{e.preventDefault();const t=e.target.input.value;try{const e=await fetch("/api/setDatabaseUri",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({databaseURI:t})}),n=await e.json();e.ok&&"Database connection updated successfully"===n.message?(await l(),a("/flow")):console.error(n.error||"Failed to update database URI")}catch(n){console.error("Error:",n)}},children:[t.jsx(O,{name:"input",type:"input",className:"moving-shadow",label:"URI String",placeholder:"Enter URI here",variant:"outlined",style:{width:"40vw",color:"#646cff",fontSize:"20px",marginTop:"5px"},InputProps:{style:{color:"#646cff"}},InputLabelProps:{style:{color:"#646cff"}}}),t.jsx(n,{style:{marginTop:"5px",color:"#646cff"},type:"submit",children:t.jsx(F,{fontSize:"large"})})]}),t.jsx("div",{style:{height:"58px",width:"40vw",margin:"50px 0"}})]}),t.jsx("div",{className:"wave-container"}),t.jsx(he,{})]})},be=L`
query {
  getTableNames {
    name
    columns
    foreignKeys {
      columnName
      foreignTableName
      foreignColumnName
    }
  }
}
`;L`
  query GetTableData($tableName: String!) {
    getTableData(tableName: $tableName) {
      columnData
    }
  }
`,L`
  query GetTableDetails($tableName: String!) {
    getTableDetails(tableName: $tableName) {
      name
      columns
      foreignKeys {
        columnName
        foreignTableName
        foreignColumnName
      }
    }
  }
`,L`
  mutation AddColumnToTable(
    $tableName: String!
    $columnName: String!
    $dataType: String!
  ) {
    addColumnToTable(
      tableName: $tableName
      columnName: $columnName
      dataType: $dataType
    )
  }
`,L`
  mutation EditTableName($oldName: String!, $newName: String!) {
    editTableName(oldName: $oldName, newName: $newName)
  }
`,L`
  mutation DeleteTable($tableName: String!) {
    deleteTable(tableName: $tableName)
  }
`,L`
  mutation DeleteColumn($tableName: String!, $columnName: String!) {
    deleteColumn(tableName: $tableName, columnName: $columnName)
  }
`;const ge=R({palette:{mode:"dark"},typography:{fontFamily:"Fira Mono"}});function xe({router:e=Y}){const a=Z((e=>e.setTables)),{data:n,loading:l,error:s}=W(be,{onCompleted:e=>{a(e.getTableNames)}});return d.useEffect((()=>{!n||l||s||a(n.getTableNames)}),[n,l,s,a]),t.jsx(J,{theme:ge,children:t.jsx(e,{children:t.jsxs(K,{children:[t.jsx(M,{path:"/",element:t.jsx(pe,{})}),t.jsx(M,{path:"/flow",element:t.jsx(ue,{})})]})})})}const fe=new B({uri:"/api/graphql",cache:new G});X.createRoot(document.getElementById("root")).render(t.jsx(a.StrictMode,{children:t.jsx(V,{client:fe,children:t.jsx(xe,{})})}));
